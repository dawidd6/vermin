<div id="command">
  <div class="code-font">
    <h1>create</h1>
  </div>

  <hr/>

  <div class="content">
    <p>
      <code>create</code> subcommand used to create a new VM from an
      <link-images>image</link-images>
      or from <a href="https://app.vagrantup.com/boxes/search" target="_blank">Vagrant Boxes</a>
      .
    </p>
    <p>
      This is usually your start command to use in vermin. You need to have a VM up and running so you can use it.
    </p>

    <p>
      To create a new VM, you need to pass a required parameter of the image name,
      <code>vermin create &lt;image name &gt;</code> e.g.:
    </p>
    <pre>
$ vermin create ubuntu/focal
<graycode>✔ Creating vm_01 from image ubuntu/focal
✔ Setting bridged network adapter
✔ Starting vm_01
✔ Establishing connection

VM is ready, to connect to it use:
$ vermin ssh vm_01</graycode>
    </pre>

    <div class="alert alert-light">
      Starting from version v0.94.0, vermin supports Vagrant Boxes. you need to prepend the image name
      with <code>vagrant/</code>, see the Vagrant section below for more info.
    </div>


    <p>
      Once you have a VM created from the chosen image, it is
      <link-start>started</link-start>
      as well and you can now start use it by
      <link-ssh></link-ssh>
      into it.
    </p>

    <hr/>
    <h4>Vagrant Boxes</h4>

    <p>
      Vermin working seamlessly with <a href="https://app.vagrantup.com/boxes/search" target="_blank">Vagrant Boxes</a>
      with no need to do any extra configurations or setup.
    </p>

    <p>
      To create a VM from a Vagrant Box, you need to prepend the Vagrant image name with <code>vagrant/</code> with
      optional version at the end. The full syntax is: <code>vagrant/&lt;user&gt;/&lt;image&gt;[:version]</code>
    </p>

    <p>
      For example, to create a VM from <a href="https://app.vagrantup.com/hashicorp/boxes/bionic64" target="_blank">
      <code>hashicorp/bionic64</code> </a> image at the latest version:
    </p>
    <pre>
$ vermin create vagrant/hashicorp/bionic64
<graycode>Image 'vagrant/hashicorp/bionic64' could not be found. Attempting to find and install
✔ Getting Image info from Vagrant Cloud
Downloading 100% [#####################################################################] (518/518 MB, 5.253 MB/s) [1m33s:0s]
✔ Convert Vagrant image into Vermin format
✔ Creating vm_02 from image vagrant/hashicorp/bionic64
✔ Setting bridged network adapter
✔ Starting vm_02
✔ Establishing connection

VM is ready, to connect to it use:
$ vermin ssh vm_02</graycode>
    </pre>

    <div class="alert alert-light">
      Vagrant version support is not yet available on Windows.
    </div>

    <hr/>
    <h4>Customizing Resources</h4>
    <p>
      By default, every VM created assigned <b>1 vcpu</b> and <b>1024 megabyte</b> memory. This can be changed at the
      time of the creation of the VM or later using the
      <link-update></link-update>
      command.
    </p>
    <p>
      To override the defaults at the creation time, you need to pass one of two parameters or both;
      <code>-c|--cpus</code> for cpu
      and <code>-m|--mem</code> for memory.
    </p>
    <p>
      The following code snipped will create a VM from centos/8 image with 2 cpus and 512 megabyte memory:
    </p>
    <pre>
$ vermin create centos/8 -c 2 -m 512
<graycode>✔ Creating vm_03 from image centos/8
✔ Setting bridged network adapter
✔ Starting vm_03
✔ Establishing connection

VM is ready, to connect to it use:
$ vermin ssh vm_03</graycode>
    </pre>

    <hr/>
    <h4>Provisioners</h4>
    <p>Vermin adapts the concept of provisioners where you can provision the VM as part of the creation process.</p>
    <p>
      Vermin supports two type of prisioners:
    <ul>
      <li>Shell</li>
      <li>Ansible</li>
    </ul>

    <h5>Shell provisioner</h5>
    <p>
      vermin support shell provisioning by providing a shell script that is run using a regular user <code>vermin</code>.
      However you can use the <code>sudo</code> command.

    </p>
    <div>
      <p>Sample provision script:</p>
      <pre>
# install redis
sudo apt update -y
sudo apt install redis-server -y
sudo sed -i 's/^supervised no/supervised systemd/' /etc/redis/redis.conf
sudo systemctl restart redis.service
sudo systemctl status redis
      </pre>

      <p>You need to save the provision script into a file and pass the file path to the create subcommand:</p>
      <pre>
$ vermin create ubuntu/focal -m 2048 redis.sh
<graycode>✔ Creating vm_01 from image ubuntu/focal
✔ Setting bridged network adapter
✔ Starting vm_01
✔ Establishing connection
Provisioning vm_01

WARNING: apt does not have a stable CLI interface. Use with caution in scripts.

Hit:1 http://sa.archive.ubuntu.com/ubuntu focal InRelease
...
...
Aug 16 21:04:06 verminbox systemd[1]: Started Advanced key-value store.

VM is ready, to connect to it use:
  $ vermin ssh vm_01</graycode>
    </pre>

      <p>We created a VM of image ubuntu/focal with 1 cpu (the default) and 2048 megabytes memory and installed redis on
        it</p>

    </div>


    <h5>Ansible provisioner</h5>
    <p>
      Ansible is a well-known configuration management tool. vermin support ansible playbooks to provision VMs as part
      of the creation process.

    </p>
    <div class="alert alert-light">
      Note: You need to set the <code>hosts</code> property to <code>all</code> in the playbook.
    </div>

    <p>Here's a sample playbook:</p>
    <pre>
- hosts: all
  become: yes
  tasks:
  - package:
      name: apache2
      state: present
    </pre>
    <p>And here's an example:</p>
    <pre>
$ vermin create ubuntu/focal -t ansible apache2.yaml
<graycode>✔ Creating vm_01 from image ubuntu/focal
✔ Setting bridged network adapter
✔ Starting vm_01
✔ Establishing connection
Provisioning vm_01

PLAY [all] *********************************************************************
...
...
PLAY RECAP *********************************************************************
192.168.100.155            : ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0


VM is ready, to connect to it use:
$ vermin ssh vm_01</graycode>
  </pre>

    <div class="alert alert-light">
      Note: we need to pass the flag the <code>-t|--type</code> flag. In case of ansible use <code>-t ansible</code>.
      in case of shell, you can pass <code>-t shell</code> which is the default behaviour.
    </div>

    <hr/>
    <h4>Network</h4>
    <p>
      vermin uses the bridge network of VirtualBox by default, and it will not function properly if you choose to change
      this settings.

      In fact being uses the bridge network it will allow the VMs to access other devices on the network of the host
      directly including other VMs.
    </p>

  </div>

</div>
